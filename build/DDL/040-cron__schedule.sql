USE `simbiatr_simbiat`;
CREATE TABLE IF NOT EXISTS `cron__schedule` (
  `task` varchar(100) NOT NULL COMMENT 'Task ID',
  `arguments` varchar(255) NOT NULL COMMENT 'Optional arguments in JSON string',
  `instance` int(10) unsigned NOT NULL DEFAULT 1 COMMENT 'Instance number of the task',
  `enabled` tinyint(1) unsigned NOT NULL DEFAULT 1 COMMENT 'Whether a task instance is enabled and should be run as per schedule',
  `system` tinyint(1) unsigned NOT NULL DEFAULT 0 COMMENT 'Flag indicating whether a task instance is system one and can''t be deleted from Cron\\Schedule class',
  `frequency` int(10) unsigned NOT NULL DEFAULT 0 COMMENT 'Frequency to run a task in seconds',
  `dayofmonth` varchar(255) DEFAULT NULL COMMENT 'Optional limit to run only on specific days of the month. Expects array of integers in JSON string.',
  `dayofweek` varchar(60) DEFAULT NULL COMMENT 'Optional limit to run only on specific days of the week. Expects array of integers in JSON string.',
  `priority` tinyint(3) unsigned NOT NULL DEFAULT 0 COMMENT 'Priority of the task',
  `message` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT 'Optional message, that will be shown if launched outside of CLI',
  `status` tinyint(1) unsigned NOT NULL DEFAULT 0 COMMENT 'Flag showing whether the task is running or not',
  `runby` varchar(30) DEFAULT NULL COMMENT 'If not NULL, indicates, that a task is queued for a run by a process.',
  `sse` tinyint(1) unsigned NOT NULL DEFAULT 0 COMMENT 'Flag to indicate whether task is being ran by SSE call.',
  `registered` datetime(6) NOT NULL DEFAULT current_timestamp(6) COMMENT 'When the task was initially registered.',
  `updated` datetime(6) NOT NULL DEFAULT current_timestamp(6) COMMENT 'When the task schedule was updated.',
  `nextrun` datetime(6) NOT NULL DEFAULT current_timestamp(6) COMMENT 'Next expected time for the task to be run.',
  `lastrun` datetime(6) DEFAULT NULL COMMENT 'Time of the last run attempt',
  `lastsuccess` datetime(6) DEFAULT NULL COMMENT 'Time of the last successful run',
  `lasterror` datetime(6) DEFAULT NULL COMMENT 'Time of the last error',
  PRIMARY KEY (`task`,`arguments`,`instance`) USING BTREE,
  KEY `nextrun` (`nextrun`),
  KEY `priority` (`priority`),
  KEY `status` (`status`),
  KEY `runby` (`runby`),
  KEY `lastrun` (`lastrun`),
  KEY `arguments` (`arguments`),
  KEY `enabled` (`enabled`),
  CONSTRAINT `schedule_to_task` FOREIGN KEY (`task`) REFERENCES `cron__tasks` (`task`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_as_cs ROW_FORMAT=DYNAMIC `PAGE_COMPRESSED`='ON';