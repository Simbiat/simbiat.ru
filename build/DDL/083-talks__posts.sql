USE `simbiatr_simbiat`;
CREATE TABLE IF NOT EXISTS `talks__posts` (
  `post_id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Post ID',
  `thread_id` int(10) unsigned NOT NULL COMMENT 'ID of a thread the post belongs to',
  `reply_to` int(10) unsigned DEFAULT NULL COMMENT 'Indicates an ID of a post, that this is a reply to (required to build chains)',
  `system` tinyint(1) unsigned NOT NULL DEFAULT 0 COMMENT 'Flag indicating that post is system one, thus should not be deleted.',
  `locked` tinyint(1) unsigned NOT NULL DEFAULT 0 COMMENT 'Flag to indicate if post is locked from editing',
  `created` datetime(6) NOT NULL DEFAULT current_timestamp(6) COMMENT 'When post was created',
  `author` int(10) unsigned NOT NULL DEFAULT 1 COMMENT 'User ID of the creator',
  `updated` datetime(6) NOT NULL DEFAULT current_timestamp(6) ON UPDATE current_timestamp(6) COMMENT 'When post was updated',
  `editor` int(10) unsigned NOT NULL DEFAULT 1 COMMENT 'User ID of the last updater',
  `text` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT 'Text of the post',
  PRIMARY KEY (`post_id`) USING BTREE,
  KEY `post_to_thread` (`thread_id`),
  KEY `post_to_post` (`reply_to`),
  KEY `post_created_by` (`author`),
  KEY `post_updated_by` (`editor`),
  KEY `created_desc` (`created` DESC),
  KEY `created_asc` (`created`),
  FULLTEXT KEY `text` (`text`),
  CONSTRAINT `post_created_by` FOREIGN KEY (`author`) REFERENCES `uc__users` (`user_id`) ON UPDATE CASCADE,
  CONSTRAINT `post_to_post` FOREIGN KEY (`reply_to`) REFERENCES `talks__posts` (`post_id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `post_to_thread` FOREIGN KEY (`thread_id`) REFERENCES `talks__threads` (`thread_id`) ON UPDATE CASCADE,
  CONSTRAINT `post_updated_by` FOREIGN KEY (`editor`) REFERENCES `uc__users` (`user_id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_as_cs COMMENT='List of all posts' `PAGE_COMPRESSED`='ON' ROW_FORMAT=Dynamic;