export class Emails{addMailForm=null;constructor(){this.addMailForm=document.getElementById("addMailForm"),this.addMailForm&&(submitIntercept(this.addMailForm,this.add.bind(this)),document.querySelectorAll(".mail_activation").forEach((e=>{e.addEventListener("click",(e=>{this.activate(e.target)}))})),document.querySelectorAll("[id^=subscription_checkbox_]").forEach((e=>{e.addEventListener("click",(e=>{this.subscribe(e)}))})),document.querySelectorAll(".mail_deletion").forEach((e=>{e.addEventListener("click",(e=>{this.delete(e.target)}))})))}add(){let e=new FormData(this.addMailForm);if(!e.get("email"))return new Snackbar("Please, enter a valid email address","failure"),!1;let t=String(e.get("email")),a=document.getElementById("addMail_spinner");a.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/emails/add/",e,"json","POST",6e4,!0).then((e=>{if(!0===e.data){let e=document.getElementById("emailsList").insertRow();e.classList.add("middle");let a=e.insertCell();a.innerHTML=t,a=e.insertCell(),a.innerHTML='<input type="button" value="Confirm" class="mail_activation" data-email="'+t+'" aria-invalid="false" placeholder="Confirm"><img class="hidden spinner inline" src="/img/spinner.svg" alt="Activating '+t+'..." data-tooltip="Activating '+t+'...">',a=e.insertCell(),a.innerHTML="Confirm address to change setting",a.classList.add("warning"),a=e.insertCell(),a.innerHTML='<td><input class="mail_deletion" data-email="'+t+'" type="image" src="/img/close.svg" alt="Delete '+t+'" aria-invalid="false" placeholder="image" data-tooltip="Delete '+t+'" tabindex="0"><img class="hidden spinner inline" src="/img/spinner.svg" alt="Removing '+t+'..." data-tooltip="Removing '+t+'...">';let i=a.getElementsByTagName("input")[0];(new Input).init(i),e.querySelectorAll(".mail_activation").forEach((e=>{e.addEventListener("click",(e=>{this.activate(e.target)}))})),e.querySelectorAll("[id^=subscription_checkbox_]").forEach((e=>{e.addEventListener("click",(e=>{this.subscribe(e)}))})),e.querySelectorAll(".mail_deletion").forEach((e=>{e.addEventListener("click",(e=>{this.delete(e.target)}))})),this.blockDelete(),this.addMailForm.reset(),new Snackbar(t+" added","success")}else new Snackbar(e.reason,"failure",1e4);a.classList.add("hidden")}))}delete(e){let t=e.parentElement.parentElement.parentElement,a=e.parentElement.parentElement.rowIndex-1,i=e.parentElement.getElementsByClassName("spinner")[0],n=new FormData,l=e.getAttribute("data-email")??"";n.set("email",l),i.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/emails/delete/",n,"json","DELETE",6e4,!0).then((e=>{!0===e.data?(t.deleteRow(a),this.blockDelete(),new Snackbar(l+" removed","success")):new Snackbar(e.reason,"failure",1e4),i.classList.add("hidden")}))}blockDelete(){let e=document.getElementsByClassName("mail_confirmed").length;document.querySelectorAll(".mail_deletion").forEach((t=>{if(t.parentElement.parentElement.getElementsByClassName("mail_confirmed").length>0)t.disabled=e<2;else if(t.disabled=!1,t.getAttribute("data-tooltip")&&"Can't delete"===t.getAttribute("data-tooltip")){let e=t.parentElement.parentElement.getElementsByTagName("td")[0].innerHTML;t.setAttribute("data-tooltip","Delete "+e);let a=t.parentElement.getElementsByClassName("spinner")[0];a.setAttribute("data-tooltip","Removing "+e+"..."),a.setAttribute("alt","Removing "+e+"...")}}))}subscribe(e){e.preventDefault(),e.stopPropagation();let t,a=e.target;t=a.checked?"subscribe":"unsubscribe";let i=a.parentElement.getElementsByTagName("label")[0],n=a.parentElement.parentElement.getElementsByClassName("spinner")[0],l=a.getAttribute("data-email")??"",s=new FormData;s.set("verb",t),s.set("email",l),n.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/emails/"+t+"/",s,"json","PATCH",6e4,!0).then((e=>{!0===e.data?a.checked?(a.checked=!1,i.innerText="Subscribe",new Snackbar(l+" unsubscribed","success")):(a.checked=!0,i.innerText="Unsubscribe",new Snackbar(l+" subscribed","success")):new Snackbar(e.reason,"failure",1e4),n.classList.add("hidden")}))}activate(e){let t=e.parentElement.getElementsByClassName("spinner")[0],a=e.getAttribute("data-email")??"",i=new FormData;i.set("verb","activate"),i.set("email",a),t.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/emails/activate/",i,"json","PATCH",6e4,!0).then((e=>{!0===e.data?new Snackbar("Activation email sent to "+a,"success"):new Snackbar(e.reason,"failure",1e4),t.classList.add("hidden")}))}}
//# sourceMappingURL=emails.min.js.map