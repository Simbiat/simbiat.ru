"use strict";const pageTitle=" on Simbiat Software";function init(){new Input,new Textarea,new Form,ucInit(),bicInit(),new Details,new Quotes,fftrackerInit(),new Aside,new Nav,new Headings,customElements.define("back-to-top",BackToTop),customElements.define("time-r",Timer),customElements.define("web-share",WebShare),customElements.define("tool-tip",Tooltip),customElements.define("snack-close",SnackbarClose),customElements.define("gallery-overlay",Gallery),customElements.define("image-carousel",CarouselList),new A,cleanGET(),hashCheck()}async function ajax(e,t=null,n="json",a="GET",i=6e4,s=!1){let r,o=new AbortController;setTimeout((()=>o.abort()),i);try{let i=await fetch(e,{method:a,mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:{"X-CSRF-Token":getMeta("X-CSRF-Token")??""},redirect:"error",referrer:window.location.href,referrerPolicy:"same-origin",keepalive:!1,signal:o.signal,body:["POST","PUT","DELETE","PATCH"].includes(a)?t:null});return i.ok||s?(r="json"===n?await i.json():"blob"===n?await i.blob():"array"===n?await i.arrayBuffer():"form"===n?await i.formData():await i.text(),r):(new Snackbar('Request to "'+e+'" returned code '+i.status,"failure",1e4),!1)}catch(t){"AbortError"===t.name?new Snackbar('Request to "'+e+'" timed out after '+i+" milliseconds","failure",1e4):new Snackbar('Request to "'+e+'" failed on fetch operation',"failure",1e4)}}function getMeta(e){let t=Array.from(document.getElementsByTagName("meta")).find((t=>t.name===e));return t?t.getAttribute("content"):null}function updateHistory(e,t){document.title=t,window.history.pushState(t,t,e)}function cleanGET(){let e=new URL(document.location.href),t=new URLSearchParams(e.search);t.delete("cacheReset"),""===t.toString()?window.history.replaceState(document.title,document.title,location.pathname+location.hash):window.history.replaceState(document.title,document.title,"?"+t+location.hash)}function hashCheck(){let e=new URL(document.location.href).hash,t=document.getElementsByTagName("gallery-overlay")[0];if(new RegExp("#gallery=\\d+","ui").test(e)){let n=Number(e.replace(/(#gallery=)(\d+)/iu,"$2"));n&&(t.images[n-1]?t.current=n-1:(new Snackbar("Image number "+n+" not found on page","failure"),window.history.replaceState(document.title,document.title,document.location.href.replace(e,""))))}else t.close()}document.addEventListener("DOMContentLoaded",init),window.addEventListener("hashchange",(function(){hashCheck()}));class BackToTop extends HTMLElement{static content;static BTTs;constructor(){super(),BackToTop.content||(BackToTop.content=document.getElementById("content"),BackToTop.BTTs=Array.from(document.getElementsByTagName("back-to-top")),BackToTop.content.addEventListener("scroll",this.toggleButtons.bind(this))),this.addEventListener("click",(()=>{BackToTop.content.scrollTop=0}))}toggleButtons(){BackToTop.BTTs&&(0===BackToTop.content.scrollTop?BackToTop.BTTs.forEach((e=>{e.classList.add("hidden")})):BackToTop.BTTs.forEach((e=>{e.classList.remove("hidden")})))}}class Gallery extends HTMLElement{_current=0;images=[];get current(){return this._current}set current(e){e<0?this._current=this.images.length-1:e>this.images.length-1?this._current=0:this._current=e,(this.images.length>1||this.classList.contains("hidden"))&&this.open()}constructor(){super(),this.images=Array.from(document.querySelectorAll(".galleryZoom")),this.images.length>0&&(customElements.define("gallery-close",GalleryClose),customElements.define("gallery-prev",GalleryPrev),customElements.define("gallery-next",GalleryNext),customElements.define("gallery-image",GalleryImage),this.images.forEach(((e,t)=>{e.addEventListener("click",(e=>(e.preventDefault(),e.stopPropagation(),this.current=t,!1)))})),this.addEventListener("keydown",this.keyNav.bind(this)))}open(){this.tabIndex=99;let e=this.images[this.current],t=e.getElementsByTagName("img")[0],n=e.parentElement.getElementsByTagName("figcaption")[0],a=e.getAttribute("data-tooltip")??e.getAttribute("title")??t.getAttribute("alt")??e.href.replace(/^.*[\\\/]/u,"");document.getElementById("galleryName").innerHTML=n?n.innerHTML:a,document.getElementById("galleryNameLink").href=document.getElementById("galleryLoadedImage").src=e.href,document.getElementById("galleryTotal").innerText=this.images.length.toString(),document.getElementById("galleryCurrent").innerText=(this.current+1).toString(),this.classList.remove("hidden"),this.history(),this.focus()}close(){this.tabIndex=-1,this.classList.add("hidden"),this.history(),document.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0].focus()}previous(){this.current--}next(){this.current++}keyNav(e){return e.stopPropagation(),["ArrowDown","ArrowRight","PageDown"].includes(e.code)?(this.next(),!1):["ArrowUp","ArrowLeft","PageUp"].includes(e.code)?(this.previous(),!1):"End"===e.code?(this.current=this.images.length-1,!1):"Home"===e.code?(this.current=0,!1):!["Escape","Backspace"].includes(e.code)||(this.close(),!1)}history(){const e=new URL(document.location.href),t=(this.current+1).toString(),n=new RegExp("(.+"+pageTitle+")(, Image \\d+)?","ui");let a,i;this.classList.contains("hidden")?(i=document.title.replace(/(.*)(, Image )(\d+)/iu,"$1"),a=document.location.href.replace(e.hash,"")):(i=document.title.replace(n,"$1, Image "+t),a=document.location.href.replace(/([^#]+)((#gallery=\d+)|$)/iu,"$1#gallery="+t)),document.location.href!==a&&updateHistory(a,i)}}class GalleryImage extends HTMLElement{image;constructor(){super(),this.image=document.getElementById("galleryLoadedImage"),this.image.addEventListener("load",this.checkZoom.bind(this))}checkZoom(){this.image.naturalHeight<=this.image.height?(this.image.classList.add("noZoom"),this.image.removeEventListener("click",this.zoom.bind(this))):(this.image.classList.remove("noZoom"),this.image.addEventListener("click",this.zoom.bind(this)))}zoom(){this.image.classList.contains("zoomedIn")?this.image.classList.remove("zoomedIn"):this.image.classList.add("zoomedIn")}}class GalleryPrev extends HTMLElement{overlay;constructor(){super(),this.overlay=document.getElementsByTagName("gallery-overlay")[0],this.overlay.images.length>1?this.addEventListener("click",(()=>{this.overlay.previous()})):this.classList.add("disabled")}}class GalleryNext extends HTMLElement{overlay;constructor(){super(),this.overlay=document.getElementsByTagName("gallery-overlay")[0],this.overlay.images.length>1?this.addEventListener("click",(()=>{this.overlay.next()})):this.classList.add("disabled")}}class GalleryClose extends HTMLElement{constructor(){super(),this.addEventListener("click",(()=>{document.getElementsByTagName("gallery-overlay")[0].close()}))}}class CarouselList extends HTMLElement{list;next;previous;maxScroll=0;constructor(){super(),this.list=this.getElementsByClassName("imageCarouselList")[0],this.next=this.getElementsByClassName("imageCarouselNext")[0],this.previous=this.getElementsByClassName("imageCarouselPrev")[0],this.list&&this.next&&this.previous&&(this.maxScroll=this.list.scrollWidth-this.list.offsetWidth,this.list.addEventListener("scroll",(()=>{this.disableScroll()})),[this.next,this.previous].forEach((e=>{e.addEventListener("click",(e=>{this.toScroll(e)}))})),this.disableScroll())}toScroll(e){let t=e.target,n=this.list.getElementsByTagName("img")[0].width;t.classList.contains("imageCarouselPrev")?this.list.scrollLeft-=n:this.list.scrollLeft+=n,this.disableScroll()}disableScroll(){0===this.list.scrollLeft?this.previous.classList.add("disabled"):this.previous.classList.remove("disabled"),this.list.scrollLeft>=this.maxScroll?this.next.classList.add("disabled"):this.next.classList.remove("disabled")}}class Snackbar{snacks;static notificationIndex=0;constructor(e,t="",n=3e3){if(this.snacks=document.getElementsByTagName("snack-bar")[0],this.snacks){let a=document.createElement("dialog"),i=Snackbar.notificationIndex++;a.setAttribute("id","snackbar"+i),a.setAttribute("role","alert"),a.classList.add("snackbar"),a.innerHTML='<span class="snack_text">'+e+'</span><snack-close data-close-in="'+n+'"><input class="navIcon snack_close" alt="Close notification" type="image" src="/img/close.svg" aria-invalid="false" placeholder="image"></snack-close>',t&&a.classList.add(t),this.snacks.appendChild(a),a.classList.add("fadeIn")}}}class SnackbarClose extends HTMLElement{snackbar;snack;constructor(){super(),this.snack=this.parentElement,this.snackbar=document.getElementsByTagName("snack-bar")[0],this.addEventListener("click",this.close);let e=parseInt(this.getAttribute("data-close-in")??"0");e>0&&setTimeout((()=>{this.close()}),e)}close(){this.snack.classList.remove("fadeIn"),this.snack.classList.add("fadeOut"),this.snack.addEventListener("animationend",(()=>{this.snackbar.removeChild(this.snack)}))}}class Timer extends HTMLElement{interval=null;constructor(){super(),this.interval=setInterval((()=>{parseInt(this.innerHTML)>0||Boolean(this.getAttribute("data-negative"))?Boolean(this.getAttribute("data-increase"))?this.innerHTML=String(parseInt(this.innerHTML)+1):this.innerHTML=String(parseInt(this.innerHTML)-1):(clearInterval(Number(this.interval)),"refresh_timer"===this.id&&location.reload())}),1e3)}}class Tooltip extends HTMLElement{x=0;y=0;constructor(){super(),document.querySelectorAll('[alt]:not([alt=""]):not([data-tooltip]), [title]:not([title=""]):not([data-tooltip])').forEach((e=>{e.parentElement.hasAttribute("data-tooltip")||e.setAttribute("data-tooltip",e.getAttribute("alt")??e.getAttribute("title")??"")})),document.querySelectorAll("[data-tooltip]:not([tabindex])").forEach((e=>{e.setAttribute("tabindex","0")})),document.addEventListener("mousemove",this.onMouseMove.bind(this)),document.querySelectorAll('[data-tooltip]:not([Data-Attribute=""])').forEach((e=>{e.addEventListener("focus",this.onFocus.bind(this))})),document.querySelectorAll(":not([data-tooltip])").forEach((e=>{e.addEventListener("focus",(()=>{this.removeAttribute("data-tooltip")}))}))}onMouseMove(e){this.update(e.target),this.x=e.clientX,this.y=e.clientY,this.tooltipCursor()}onFocus(e){this.update(e.target);let t=e.target.getBoundingClientRect();this.x=t.x,this.y=t.y-1.5*this.offsetHeight,this.tooltipCursor()}tooltipCursor(){this.y+this.offsetHeight>window.innerHeight&&(this.y=window.innerHeight-2*this.offsetHeight),this.x+this.offsetWidth>window.innerWidth&&(this.x=window.innerWidth-1.5*this.offsetWidth),document.documentElement.style.setProperty("--cursorX",this.x+"px"),document.documentElement.style.setProperty("--cursorY",this.y+"px")}update(e){let t=e.parentElement;e.hasAttribute("data-tooltip")||t.hasAttribute("data-tooltip")?this.setAttribute("data-tooltip",e.getAttribute("data-tooltip")??t.getAttribute("data-tooltip")??""):this.removeAttribute("data-tooltip")}}class WebShare extends HTMLElement{constructor(){super(),this&&(void 0!==navigator.share?(this.classList.remove("hidden"),this.addEventListener("click",this.share)):this.classList.add("hidden"))}share(){return navigator.share({title:document.title,text:getMeta("og:description")??getMeta("description")??"",url:document.location.href})}}class A{static _instance=null;constructor(){if(A._instance)return A._instance;document.querySelectorAll('a[target="_blank"]').forEach((e=>{e.innerHTML.includes("img/newtab.svg")||e.classList.contains("galleryZoom")||e.classList.contains("footerLink")||(e.innerHTML+='<img class="newTabIcon" src="/img/newtab.svg" alt="Opens in new tab">')})),A._instance=this}}class Aside{static _instance=null;sidebarDiv=null;constructor(){if(Aside._instance)return Aside._instance;this.sidebarDiv=document.getElementById("sidebar"),document.getElementById("showSidebar").addEventListener("click",(()=>{this.sidebarDiv.classList.add("shown")})),document.getElementById("hideSidebar").addEventListener("click",(()=>{this.sidebarDiv.classList.remove("shown")})),Aside._instance=this}}class Details{static list;static _instance=null;constructor(){if(Details._instance)return Details._instance;Details.list=Array.from(document.getElementsByTagName("details")),Details.list.forEach(((e,t,n)=>{e.ontoggle=t=>{e.open&&!e.classList.contains("persistent")&&n.forEach((t=>{t===e||t.classList.contains("persistent")||(t.open=!1)}))}})),Details.list.forEach((e=>{e.addEventListener("click",(e=>{this.reset(e.target)}))})),Details._instance=this}reset(e){Details.list.forEach((t=>{t.open&&t!==e&&!t.contains(e)&&(t.open=!1)}))}}class Form{static _instance=null;constructor(){if(Form._instance)return Form._instance;document.querySelectorAll("form").forEach((e=>{e.addEventListener("keypress",(e=>{this.formEnter(e)}))})),document.querySelectorAll("form[data-baseURL] input[type=search]").forEach((e=>{e.addEventListener("input",this.searchAction.bind(this)),e.addEventListener("change",this.searchAction.bind(this)),e.addEventListener("focus",this.searchAction.bind(this))})),document.querySelectorAll('form input[type="email"], form input[type="password"], form input[type="search"], form input[type="tel"], form input[type="text"], form input[type="url"]').forEach((e=>{e.addEventListener("keydown",this.inputBackSpace.bind(this)),e.getAttribute("maxlength")&&(e.addEventListener("input",this.autoNext.bind(this)),e.addEventListener("change",this.autoNext.bind(this)),e.addEventListener("paste",this.pasteSplit.bind(this)))})),Form._instance=this}formEnter(e){let t=e.target.form;if(!("Enter"!==e.code&&"NumpadEnter"!==e.code||t.action&&t.getAttribute("data-baseURL")&&location.protocol+"//"+location.host+t.getAttribute("data-baseURL")!==t.action))return e.stopPropagation(),e.preventDefault(),!1}searchAction(e){let t=e.target,n=t.form;""===t.value?n.action=String(n.getAttribute("data-baseURL")):n.action=n.getAttribute("data-baseURL")+this.rawurlencode(t.value),n.method="get"}rawurlencode(e){return e+="",encodeURIComponent(e).replace(/!/gu,"%21").replace(/'/gu,"%27").replace(/\(/gu,"%28").replace(/\)/gu,"%29").replace(/\*/gu,"%2A")}inputBackSpace(e){let t=e.target;if("Backspace"===e.code&&!t.value){let e=this.nextInput(t,!0);e&&(e.focus(),e.selectionStart=e.selectionEnd=e.value.length)}}autoNext(e){let t=e.target,n=parseInt(t.getAttribute("maxlength")??"0");if(n&&t.value.length===n&&t.validity.valid){let e=this.nextInput(t,!1);e&&e.focus()}}nextInput(e,t=!1){let n=e.form;if(n){let a;for(let i of n.querySelectorAll("input")){if(t){if(i===e)return a||!1}else if(a&&a===e)return i;a=i}}return!1}async pasteSplit(e){let t=await navigator.permissions.query({name:"clipboard-read"}).catch((()=>{console.error("Your browser does not support clipboard-read permission.")}));t&&"denied"!==t.state&&navigator.clipboard.readText().then((t=>{let n=t.toString(),a=e.target,i=parseInt(a.getAttribute("maxlength")??"0");for(;a&&i&&n.length>i;){if(a.value=n.substring(0,i),a.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),!a.validity.valid)return!1;n=n.substring(i),a=this.nextInput(a,!1),a&&(a.focus(),i=parseInt(a.getAttribute("maxlength")??"0"))}return a&&(a.value=n,a.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))),!0}))}}class Headings{static _instance=null;constructor(){if(Headings._instance)return Headings._instance;document.querySelectorAll("h1:not(#h1title), h2, h3, h4, h5, h6").forEach((e=>{if(!e.hasAttribute("id")){let t=String(e.textContent).replaceAll(/\s/gmu,"_").replaceAll(/[^\p{L}\p{N}_\-]/gmu,"").replaceAll(/(^.{1,64})(.*$)/gmu,"$1"),n=1,a=t;for(;document.getElementById(a);)n++,a=t+"_"+n;e.setAttribute("id",a)}e.addEventListener("click",(e=>{this.copyLink(e.target)}))})),Headings._instance=this}copyLink(e){if("Range"!==window.getSelection().type){let t=window.location.href.replaceAll(/(^[^#]*)(#.*)?$/gmu,"$1")+"#"+e.getAttribute("id");return navigator.clipboard.writeText(t).then((function(){new Snackbar('Anchor link for "'+e.textContent+'" copied to clipboard',"success")}),(function(){new Snackbar('Failed to copy anchor link for "'+e.textContent+'"',"failure")})),t}return""}}class Input{static _instance=null;constructor(){if(Input._instance)return Input._instance;Array.from(document.getElementsByTagName("input")).forEach((e=>{this.init(e)})),Input._instance=this}init(e){e.addEventListener("focus",(()=>{this.ariaNation(e)})),e.addEventListener("change",(()=>{this.ariaNation(e)})),e.addEventListener("input",(()=>{this.ariaNation(e)})),this.ariaNation(e)}ariaNation(e){e.setAttribute("aria-invalid",String(!e.validity.valid)),e.hasAttribute("placeholder")||e.setAttribute("placeholder",e.value||e.type||"placeholder"),e.getAttribute("type")||e.setAttribute("type","text");let t=e.type??e.getAttribute("type")??"text";["text","search","url","tel","email","password","date","month","week","time","datetime-local","number","checkbox","radio","file"].includes(String(t))&&(e.required?e.setAttribute("aria-required",String(!0)):e.setAttribute("aria-required",String(!1))),"checkbox"===t&&(e.setAttribute("role","checkbox"),e.setAttribute("aria-checked",String(e.checked)),e.indeterminate&&e.setAttribute("aria-checked","mixed")),"checkbox"===t&&e.setAttribute("value",e.value)}}class Nav{static _instance=null;navDiv=null;constructor(){if(Nav._instance)return Nav._instance;this.navDiv=document.getElementById("navigation"),document.getElementById("showNav").addEventListener("click",(()=>{this.navDiv.classList.add("shown")})),document.getElementById("hideNav").addEventListener("click",(()=>{this.navDiv.classList.remove("shown")})),Nav._instance=this}}class Quotes{static _instance=null;constructor(){if(Quotes._instance)return Quotes._instance;document.querySelectorAll("samp, code, blockquote").forEach((e=>{e.innerHTML='<img loading="lazy" decoding="async"  src="/img/copy.svg" alt="Click to copy block" class="copyQuote">'+e.innerHTML})),Array.from(document.getElementsByTagName("q")).forEach((e=>{e.setAttribute("data-tooltip","Click to copy quote")})),document.querySelectorAll(".copyQuote, q").forEach((e=>{e.addEventListener("click",(e=>{this.copy(e.target)}))})),Quotes._instance=this}copy(e){let t;switch("q"!==e.tagName.toLowerCase()&&(e=e.parentElement),e.tagName.toLowerCase()){case"samp":t="Sample";break;case"code":t="Code";break;case"blockquote":case"q":t="Quote"}return navigator.clipboard.writeText(String(e.textContent)).then((function(){new Snackbar(t+" copied to clipboard","success")}),(function(){new Snackbar("Failed to copy "+t.toLowerCase(),"failure")})),String(e.textContent)}}class Textarea{static _instance=null;constructor(){if(Textarea._instance)return Textarea._instance;Array.from(document.getElementsByTagName("textarea")).forEach((e=>{e.hasAttribute("placeholder")||e.setAttribute("placeholder",e.value||e.type||"placeholder")})),Textarea._instance=this}}function bicInit(){let e=document.getElementById("bic_key"),t=document.getElementById("account_key");e&&t&&(e.addEventListener("input",bicCalc),t.addEventListener("input",bicCalc));let n=document.getElementById("bicRefresh");n&&n.addEventListener("click",bicRefresh)}function bicCalc(){let e=document.getElementById("bic_keying"),t=new FormData(e),n=document.getElementById("accCheckResult"),a=String(t.get("bic_key")),i=String(t.get("account_key")),s=document.getElementById("bic_key_sample"),r=document.getElementById("account_key_sample");if(n.classList.remove(...n.classList),null===/^\d{9}$/u.exec(a))return n.classList.add("failure"),n.innerHTML="Неверный формат БИКа",void bicStyle(s,"warning","БИК");if(bicStyle(s,"success",a),null===/^\d{5}[\dАВСЕНКМРТХавсенкмртх]\d{14}$/u.exec(i))return n.classList.add("failure"),n.innerHTML="Неверный формат счёта",void bicStyle(r,"warning","СЧЁТ");bicStyle(r,"success",i),updateHistory(location.protocol+"//"+location.host+"/bictracker/keying/"+a+"/"+i+"/","Ключевание счёта "+i+pageTitle),n.classList.add("warning"),n.innerHTML="Проверяем...";let o=document.getElementById("bic_spinner");o.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/bictracker/keying/",t,"json","POST",6e4,!0).then((e=>{n.classList.remove(...n.classList),!0===e.data?(n.classList.add("success"),n.innerHTML="Правильное ключевание"):(n.classList.add("failure"),!1===e.data?n.innerHTML="Непредвиденная ошибка":n.innerHTML="Неверное ключевание. Ожидаемый ключ: "+e.data+" ("+i.replace(/(^\d{5}[\dАВСЕНКМРТХавсенкмртх]\d{2})(\d)(\d{11})$/u,'$1<span class="success">'+e.data+"</span>$3")+")"),o.classList.add("hidden")}))}function bicStyle(e,t,n=""){e.classList.remove(...e.classList),e.classList.add(t),e.innerHTML=n}function bicRefresh(e){let t=e.target;t.classList.contains("spin")?(e.stopPropagation(),e.preventDefault()):(t.classList.add("spin"),setTimeout((async function(){await ajax(location.protocol+"//"+location.host+"/api/bictracker/dbupdate/",null,"json","PUT",3e5).then((n=>{if(!0===n.data)new Snackbar("Библиотека БИК обновлена","success"),t.classList.remove("spin");else if("number"==typeof n.data){let a=new Date(1e3*n.data),i=document.getElementsByClassName("bic_date")[0];i.setAttribute("datetime",a.toISOString()),i.innerHTML=("0"+String(a.getUTCDate())).slice(-2)+"."+("0"+String(a.getMonth()+1)).slice(-2)+"."+String(a.getUTCFullYear()),new Snackbar("Применено обновление за "+i.innerHTML,"success"),t.classList.remove("spin"),bicRefresh(e)}else new Snackbar("Не удалось обновить библиотеку БИК","failure",1e4),t.classList.remove("spin")}))}),500))}function fftrackerInit(){let e=document.getElementById("ff_track_type");e&&e.addEventListener("change",(function(e){ffTrackTypeChange(e.target)})),submitIntercept("ff_track_register")}function ffTrackAdd(){let e,t=document.getElementById("ff_track_id"),n=document.getElementById("ff_track_type"),a=n.selectedOptions[0];if(e=a?a.text:"Character",t&&n){let a=document.getElementById("ff_track_spinner");a.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/fftracker/"+n.value+"/"+t.value+"/",null,"json","POST",6e4,!0).then((i=>{!0===i.data?new Snackbar(e+" with ID "+t.value+' was registered. Check <a href="'+location.protocol+"//"+location.host+"/fftracker/"+n.value+"/"+t.value+'/" target="_blank">here</a>.',"success",0):new Snackbar("404"===i?e+" with ID "+t.value+" was not found on Lodestone.":i.reason,"failure",1e4),a.classList.add("hidden")}))}}function ffTrackTypeChange(e){let t=document.getElementById("ff_track_id"),n="^\\d+$";switch(e.value){case"character":case"freecompany":case"linkshell":n="^\\d{1,20}$";break;case"pvpteam":case"crossworld_linkshell":n="^[0-9a-z]{40}$"}t.setAttribute("pattern",n)}const submitFunctions={signinup:"singInUpSubmit",addMailForm:"addMail",ff_track_register:"ffTrackAdd",password_change:"passwordChange"};function submitIntercept(e){let t=document.getElementById(e);t&&submitFunctions[e]&&(t.addEventListener("submit",(function(t){return t.preventDefault(),t.stopPropagation(),window[submitFunctions[e]](),!1})),t.onkeydown=function(t){return"Enter"!==t.code||(t.preventDefault(),t.stopPropagation(),window[submitFunctions[e]](),!1)})}function ucInit(){document.querySelectorAll(".showpassword").forEach((e=>{e.addEventListener("click",showPassToggle)})),document.querySelectorAll("#radio_signinup input[type=radio]").forEach((e=>{e.addEventListener("change",loginRadioCheck)})),loginRadioCheck(),submitIntercept("signinup"),submitIntercept("addMailForm"),submitIntercept("password_change"),document.querySelectorAll(".mail_activation").forEach((e=>{e.addEventListener("click",activationMail)})),document.querySelectorAll("[id^=subscription_checkbox_]").forEach((e=>{e.addEventListener("click",subscribeMail)})),document.querySelectorAll(".mail_deletion").forEach((e=>{e.addEventListener("click",deleteMail)}));let e=document.getElementById("new_password");e&&["focus","change","input"].forEach((function(t){e.addEventListener(t,passwordStrengthOnEvent)}))}function addMail(){let e=document.getElementById("addMailForm"),t=new FormData(e);if(!t.get("email"))return new Snackbar("Please, enter a valid email address","failure"),!1;let n=String(t.get("email")),a=document.getElementById("addMail_spinner");a.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/emails/add/",t,"json","POST",6e4,!0).then((t=>{if(!0===t.data){let t=document.getElementById("emailsList").insertRow();t.classList.add("middle");let a=t.insertCell();a.innerHTML=n,a=t.insertCell(),a.innerHTML='<input type="button" value="Confirm" class="mail_activation" data-email="'+n+'" aria-invalid="false" placeholder="Confirm"><img class="hidden spinner inline" src="/img/spinner.svg" alt="Activating '+n+'..." data-tooltip="Activating '+n+'...">',a=t.insertCell(),a.innerHTML="Confirm address to change setting",a.classList.add("warning"),a=t.insertCell(),a.innerHTML='<td><input class="mail_deletion" data-email="'+n+'" type="image" src="/img/close.svg" alt="Delete '+n+'" aria-invalid="false" placeholder="image" data-tooltip="Delete '+n+'" tabindex="0"><img class="hidden spinner inline" src="/img/spinner.svg" alt="Removing '+n+'..." data-tooltip="Removing '+n+'...">';let i=a.getElementsByTagName("input")[0];(new Input).init(i),blockDeleteMail(),e.reset(),new Snackbar("Mail added","success")}else new Snackbar(t.reason,"failure",1e4);a.classList.add("hidden")}))}function deleteMail(e){let t=e.target,n=t.parentElement.parentElement.parentElement,a=t.parentElement.parentElement.rowIndex-1,i=t.parentElement.getElementsByClassName("spinner")[0],s=new FormData;s.set("email",t.getAttribute("data-email")??""),i.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/emails/delete/",s,"json","DELETE",6e4,!0).then((e=>{!0===e.data?(n.deleteRow(a),blockDeleteMail(),new Snackbar("Mail removed","success")):new Snackbar(e.reason,"failure",1e4),i.classList.add("hidden")}))}function blockDeleteMail(){let e=document.getElementsByClassName("mail_confirmed").length;document.querySelectorAll(".mail_deletion").forEach((t=>{t.parentElement.parentElement.getElementsByClassName("mail_confirmed").length>0?t.disabled=e<2:t.disabled=!1}))}function subscribeMail(e){e.preventDefault(),e.stopPropagation();let t,n=e.target;t=n.checked?"subscribe":"unsubscribe";let a=n.parentElement.getElementsByTagName("label")[0],i=n.parentElement.parentElement.getElementsByClassName("spinner")[0],s=new FormData;s.set("verb",t),s.set("email",n.getAttribute("data-email")??""),i.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/emails/"+t+"/",s,"json","PATCH",6e4,!0).then((e=>{!0===e.data?n.checked?(n.checked=!1,a.innerText="Subscribe",new Snackbar("Email unsubscribed","success")):(n.checked=!0,a.innerText="Unsubscribe",new Snackbar("Email subscribed","success")):new Snackbar(e.reason,"failure",1e4),i.classList.add("hidden")}))}function activationMail(e){let t=e.target,n=t.parentElement.getElementsByClassName("spinner")[0],a=new FormData;a.set("verb","activate"),a.set("email",t.getAttribute("data-email")??""),n.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/emails/activate/",a,"json","PATCH",6e4,!0).then((e=>{!0===e.data?new Snackbar("Activation email sent","success"):new Snackbar(e.reason,"failure",1e4),n.classList.add("hidden")}))}function singInUpSubmit(){let e=new FormData(document.getElementById("signinup"));e.get("signinup[type]")||e.set("signinup[type]","logout");let t=document.getElementById("singinup_spinner");t.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/signinup/"+e.get("signinup[type]")+"/",e,"json","POST",6e4,!0).then((n=>{!0===n.data?"remind"===e.get("signinup[type]")?new Snackbar("If respective account is registered an email has been sent with password reset link.","success"):location.reload():new Snackbar(n.reason,"failure",1e4),t.classList.add("hidden")}))}function passwordChange(){let e=new FormData(document.getElementById("password_change")),t=document.getElementById("pw_change_spinner");t.classList.remove("hidden"),ajax(location.protocol+"//"+location.host+"/api/uc/password/",e,"json","PATCH",6e4,!0).then((e=>{!0===e.data?new Snackbar("Password changed","success"):new Snackbar(e.reason,"failure",1e4),t.classList.add("hidden")}))}const emailRegex="[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*",userRegex="[^\\/\\\\\\[\\]:;|=$%#@&\\(\\)\\{\\}!,+*?<>\\0\\t\\r\\n\\x00-\\x1F\\x7F\\x0b\\f\\x85\\v\\cY\\b]{1,64}";function showPassToggle(e){e.preventDefault();let t=e.target,n=t.parentElement.getElementsByTagName("input").item(0);"password"===n.type?(n.type="text",t.title="Hide password"):(n.type="password",t.title="Show password")}function passwordStrengthOnEvent(e){let t=document.querySelectorAll(".password_strength").item(0),n=passwordStrength(e.target.value);t.innerHTML=n,t.classList.remove("password_weak","password_medium","password_strong","password_very_strong"),"very strong"===n?t.classList.add("password_very_strong"):t.classList.add("password_"+n)}function passwordStrength(e){let t=0;return/.{8,}/u.test(e)&&t++,/.{16,}/u.test(e)&&t++,/.{32,}/u.test(e)&&t++,/.{64,}/u.test(e)&&t++,/\p{Ll}/u.test(e)&&t++,/\p{Lu}/u.test(e)&&t++,/\p{Lo}/u.test(e)&&t++,/\p{N}/u.test(e)&&t++,/[\p{P}\p{S}]/u.test(e)&&t++,/(.)\1{2,}/u.test(e)&&t--,t<=2?"weak":2<t&&t<5?"medium":5===t?"strong":"very strong"}function loginRadioCheck(){let e,t=document.getElementById("radio_existuser"),n=document.getElementById("radio_newuser"),a=document.getElementById("radio_forget"),i=document.getElementById("signinup_email");i&&i.labels&&(e=i.labels[0]);let s=document.getElementById("signinup_password"),r=document.getElementById("signinup_submit"),o=document.getElementById("rememberme"),l=document.getElementById("signinup_username");t&&t.checked&&(s.required=!0,s.setAttribute("autocomplete","current-password"),i.setAttribute("type","email"),i.setAttribute("autocomplete","email"),i.setAttribute("pattern","^"+emailRegex+"$"),s.setAttribute("minlength","8"),r.value="Sign in",["focus","change","input"].forEach((function(e){s.removeEventListener(e,passwordStrengthOnEvent)})),s.parentElement.classList.remove("hidden"),o.parentElement.classList.remove("hidden"),document.getElementById("password_req").classList.add("hidden"),document.querySelectorAll(".pass_str_div").item(0).classList.add("hidden"),l.parentElement.classList.add("hidden"),l.required=!1),n&&n.checked&&(s.required=!0,s.setAttribute("autocomplete","new-password"),i.setAttribute("type","email"),i.setAttribute("autocomplete","email"),i.setAttribute("pattern","^"+emailRegex+"$"),s.setAttribute("minlength","8"),r.value="Join",["focus","change","input"].forEach((function(e){s.addEventListener(e,passwordStrengthOnEvent)})),s.parentElement.classList.remove("hidden"),o.parentElement.classList.remove("hidden"),document.getElementById("password_req").classList.remove("hidden"),document.querySelectorAll(".pass_str_div").item(0).classList.remove("hidden"),i.placeholder="Email",e&&(e.innerHTML="Email"),l.parentElement.classList.remove("hidden"),l.required=!0),a&&a.checked&&(s.required=!1,s.removeAttribute("autocomplete"),i.setAttribute("type","text"),i.setAttribute("autocomplete","username"),i.setAttribute("pattern","^("+userRegex+")|("+emailRegex+")$"),s.removeAttribute("minlength"),r.value="Remind",["focus","change","input"].forEach((function(e){s.removeEventListener(e,passwordStrengthOnEvent)})),s.parentElement.classList.add("hidden"),o.parentElement.classList.add("hidden"),document.getElementById("password_req").classList.add("hidden"),document.querySelectorAll(".pass_str_div").item(0).classList.add("hidden"),o.checked=!1,i.placeholder="Email or name",e&&(e.innerHTML="Email or name"),l.parentElement.classList.add("hidden"),l.required=!1),s&&(new Input).ariaNation(s)}
//# sourceMappingURL=js.map