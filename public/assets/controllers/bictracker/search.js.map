{"version":3,"file":"search.js","sourceRoot":"/js/Pages/","sources":["bictracker/search.ts"],"names":[],"mappings":"AAAA,MAAM,OAAO,UAAU;IAEF,aAAa,GAA4B,IAAI,CAAC;IAE/D;QAEI,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;QAC5D,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAiB,EAAE,EAAE;gBAC/D,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;YACxB,CAAC,CAAC,CAAC;QACP,CAAC;IACL,CAAC;IAGO,OAAO,CAAC,KAAY;QAExB,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;YACtB,OAAO;QACX,CAAC;QACD,IAAI,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC;YAEhD,KAAK,CAAC,eAAe,EAAE,CAAC;YACxB,KAAK,CAAC,cAAc,EAAE,CAAC;QAC3B,CAAC;aAAM,CAAC;YACJ,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YACzC,MAAM,CAAC,UAAU,CAAC,GAAG,EAAE;gBACnB,KAAK,IAAI,CAAC,GAAG,QAAQ,CAAC,QAAQ,KAAK,QAAQ,CAAC,IAAI,0BAA0B,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,EAAE;oBACnH,MAAM,IAAI,GAAG,QAA4B,CAAC;oBAC1C,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;wBACrB,IAAI,IAAI,CAAC,IAAI,KAAK,IAAI,EAAE,CAAC;4BACrB,WAAW,CAAC,0BAA0B,EAAE,SAAS,CAAC,CAAC;4BACnD,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;wBAChD,CAAC;6BAAM,IAAI,OAAO,IAAI,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;4BAEvC,MAAM,SAAS,GAAS,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;4BAEnD,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;4BACrD,IAAI,QAAQ,EAAE,CAAC;gCAEX,QAAQ,CAAC,YAAY,CAAC,UAAU,EAAE,SAAS,CAAC,WAAW,EAAE,CAAC,CAAC;gCAC3D,QAAQ,CAAC,SAAS,GAAG,GAAG,IAAI,MAAM,CAAC,SAAS,CAAC,UAAU,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC,EAAE,CAAC;gCACnK,WAAW,CAAC,2BAA2B,QAAQ,CAAC,SAAS,EAAE,EAAE,SAAS,CAAC,CAAC;gCACxE,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gCAC5C,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;4BACxB,CAAC;wBACL,CAAC;6BAAM,CAAC;4BACJ,WAAW,CAAC,oCAAoC,EAAE,SAAS,EAAE,kBAAkB,CAAC,CAAC;4BACjF,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;wBAChD,CAAC;oBACL,CAAC;gBACL,CAAC,CAAC,CAAC;YACX,CAAC,EAAE,GAAG,CAAC,CAAC;QACZ,CAAC;IACL,CAAC;CACJ","sourcesContent":["export class bicRefresh\r\n{\r\n    private readonly refreshButton: HTMLInputElement | null = null;\r\n\r\n    public constructor()\r\n    {\r\n        this.refreshButton = document.querySelector('#bic_refresh');\r\n        if (this.refreshButton) {\r\n            this.refreshButton.addEventListener('click', (event: MouseEvent) => {\r\n                this.refresh(event);\r\n            });\r\n        }\r\n    }\r\n\r\n    //Refresh BIC library through API\r\n    private refresh(event: Event): void\r\n    {\r\n        if (!this.refreshButton) {\r\n            return;\r\n        }\r\n        if (this.refreshButton.classList.contains('spin')) {\r\n            //It already has been clicked, cancel event\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n        } else {\r\n            this.refreshButton.classList.add('spin');\r\n            window.setTimeout(() => {\r\n                void ajax(`${location.protocol}//${location.host}/api/bictracker/dbupdate`, null, 'json', 'PUT', 300000).then((response) => {\r\n                        const data = response as ajaxJSONResponse;\r\n                        if (this.refreshButton) {\r\n                            if (data.data === true) {\r\n                                addSnackbar('Библиотека БИК обновлена', 'success');\r\n                                this.refreshButton.classList.remove('spin');\r\n                            } else if (typeof data.data === 'number') {\r\n                                //Create date from timestamp\r\n                                const timestamp: Date = new Date(data.data * 1000);\r\n                                //Get time block\r\n                                const dateTime = document.querySelector('.bic_date');\r\n                                if (dateTime) {\r\n                                    //Update its value\r\n                                    dateTime.setAttribute('datetime', timestamp.toISOString());\r\n                                    dateTime.innerHTML = `${`0${String(timestamp.getUTCDate())}`.slice(-2)}.${`0${String(timestamp.getMonth() + 1)}`.slice(-2)}.${String(timestamp.getUTCFullYear())}`;\r\n                                    addSnackbar(`Применено обновление за ${dateTime.innerHTML}`, 'success');\r\n                                    this.refreshButton.classList.remove('spin');\r\n                                    this.refresh(event);\r\n                                }\r\n                            } else {\r\n                                addSnackbar('Не удалось обновить библиотеку БИК', 'failure', SNACKBAR_FAIL_LIFE);\r\n                                this.refreshButton.classList.remove('spin');\r\n                            }\r\n                        }\r\n                    });\r\n            }, 500);\r\n        }\r\n    }\r\n}\r\n"]}