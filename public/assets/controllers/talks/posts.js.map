{"version":3,"file":"posts.js","sourceRoot":"/js/Pages/","sources":["talks/posts.ts"],"names":[],"mappings":"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","sourcesContent":["export class Posts {\r\n  private readonly post_form: HTMLFormElement | null = null;\r\n  private readonly delete_post_button: HTMLInputElement | null = null;\r\n\r\n  public constructor() {\r\n    this.post_form = document.querySelector('post-form form');\r\n    this.delete_post_button = document.querySelector('#delete_post');\r\n    //Listener for form\r\n    if (this.post_form) {\r\n      submitIntercept(this.post_form, this.editPost.bind(this));\r\n    }\r\n    //Listener for deletion\r\n    if (this.delete_post_button) {\r\n      this.delete_post_button.addEventListener('click', () => {\r\n        this.deletePost();\r\n      });\r\n    }\r\n  }\r\n\r\n  private editPost(): void {\r\n    if (this.post_form) {\r\n      //Get submit button\r\n      const button = this.post_form.querySelector('input[type=submit]');\r\n      //Get form data\r\n      const form_data = new FormData(this.post_form);\r\n      buttonToggle(button as HTMLInputElement);\r\n      ajax(`${location.protocol}//${location.host}/api/talks/posts/${String(form_data.get('post_form[post_id]') ?? '0')}/edit`, form_data, 'json', 'POST', AJAX_TIMEOUT, true)\r\n        .then((response) => {\r\n          const data = response as ajaxJSONResponse;\r\n          if (data.data === true) {\r\n            //Notify TinyMCE, that data was saved\r\n            if (this.post_form) {\r\n              const textarea = this.post_form.querySelector('textarea');\r\n              if (textarea && !empty(textarea.id)) {\r\n                saveTinyMCE(textarea.id);\r\n              }\r\n            }\r\n            addSnackbar('Post updated. Reloading...', 'success');\r\n            pageRefresh(data.location);\r\n          } else {\r\n            if (data.location) {\r\n              addSnackbar(data.reason + ` View the post <a href=\"${data.location}\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.`, 'failure', 0);\r\n            } else {\r\n              addSnackbar(data.reason, 'failure', SNACKBAR_FAIL_LIFE);\r\n            }\r\n            buttonToggle(button as HTMLInputElement);\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n  private deletePost(): void {\r\n    if (this.delete_post_button) {\r\n      if (confirm('This is the last chance to back out.\\nIf you press \\'OK\\' this post will be permanently deleted.\\nPress \\'Cancel\\' to cancel the action.')) {\r\n        const id = this.delete_post_button.getAttribute('data-post') ?? '';\r\n        if (!empty(id)) {\r\n          buttonToggle(this.delete_post_button);\r\n          ajax(`${location.protocol}//${location.host}/api/talks/posts/${id}/delete`, null, 'json', 'DELETE', AJAX_TIMEOUT, true)\r\n            .then((response) => {\r\n              const data = response as ajaxJSONResponse;\r\n              if (data.data === true) {\r\n                addSnackbar('Post removed. Redirecting to thread...', 'success');\r\n                pageRefresh(data.location);\r\n              } else {\r\n                addSnackbar(data.reason, 'failure', SNACKBAR_FAIL_LIFE);\r\n              }\r\n              if (this.delete_post_button) {\r\n                buttonToggle(this.delete_post_button);\r\n              }\r\n            });\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}