{"version":3,"file":"posts.js","sourceRoot":"/js/Pages/","sources":["talks/posts.ts"],"names":[],"mappings":"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","sourcesContent":["export class Posts {\r\n  private readonly post_form: HTMLFormElement | null = null;\r\n  private readonly delete_post_form: HTMLFormElement | null = null;\r\n  private readonly move_post_form: HTMLFormElement | null = null;\r\n\r\n  public constructor() {\r\n    this.post_form = document.querySelector('post-form form');\r\n    this.delete_post_form = document.querySelector('#delete_post_form');\r\n    this.move_post_form = document.querySelector('#post_move_form');\r\n    //Listener for form\r\n    if (this.post_form) {\r\n      submitIntercept(this.post_form, this.edit.bind(this));\r\n    }\r\n    //Listener for deletion\r\n    if (this.delete_post_form) {\r\n      submitIntercept(this.delete_post_form, this.delete.bind(this));\r\n    }\r\n    //Listener for moving the post\r\n    if (this.move_post_form) {\r\n      submitIntercept(this.move_post_form, this.move.bind(this));\r\n    }\r\n  }\r\n\r\n  private move(): void {\r\n    if (this.move_post_form) {\r\n      //Get submit button\r\n      const button = this.move_post_form.querySelector('input[type=submit]');\r\n      //Get form data\r\n      const form_data = new FormData(this.move_post_form);\r\n      buttonToggle(button as HTMLInputElement);\r\n      ajax(`${location.protocol}//${location.host}/api/talks/posts/${String(form_data.get('post_data[post_id]') ?? '0')}`, form_data, 'json', 'PATCH', AJAX_TIMEOUT, true)\r\n        .then((response) => {\r\n          const data = response as ajaxJSONResponse;\r\n          if (data.data === true) {\r\n            addSnackbar('Post moved', 'success');\r\n            pageRefresh();\r\n          } else {\r\n            addSnackbar(data.reason, 'failure', SNACKBAR_FAIL_LIFE);\r\n          }\r\n          buttonToggle(button as HTMLInputElement);\r\n        });\r\n    }\r\n  }\r\n\r\n  private edit(): void {\r\n    if (this.post_form) {\r\n      //Get submit button\r\n      const button = this.post_form.querySelector('input[type=submit]');\r\n      //Get form data\r\n      const form_data = new FormData(this.post_form);\r\n      buttonToggle(button as HTMLInputElement);\r\n      ajax(`${location.protocol}//${location.host}/api/talks/posts/${String(form_data.get('post_data[post_id]') ?? '0')}/edit`, form_data, 'json', 'PATCH', AJAX_TIMEOUT, true)\r\n        .then((response) => {\r\n          const data = response as ajaxJSONResponse;\r\n          if (data.data === true) {\r\n            //Notify TinyMCE, that data was saved\r\n            if (this.post_form) {\r\n              const textarea = this.post_form.querySelector('textarea');\r\n              if (textarea && !empty(textarea.id)) {\r\n                saveTinyMCE(textarea.id);\r\n              }\r\n            }\r\n            addSnackbar('Post updated. Reloading...', 'success');\r\n            pageRefresh(data.location);\r\n          } else {\r\n            if (data.location) {\r\n              addSnackbar(`${data.reason} View the post <a href=\"${data.location}\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.`, 'failure', 0);\r\n            } else {\r\n              addSnackbar(data.reason, 'failure', SNACKBAR_FAIL_LIFE);\r\n            }\r\n            buttonToggle(button as HTMLInputElement);\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n  private delete(): void {\r\n    if (this.delete_post_form && confirm('This is the last chance to back out.\\nIf you press \\'OK\\' this post will be permanently deleted.\\nPress \\'Cancel\\' to cancel the action.')) {\r\n      //Get submit button\r\n      const button = this.delete_post_form.querySelector('input[type=submit]');\r\n      //Get form data\r\n      const form_data = new FormData(this.delete_post_form);\r\n      buttonToggle(button as HTMLInputElement);\r\n      ajax(`${location.protocol}//${location.host}/api/talks/posts/${String(form_data.get('post_data[post_id]') ?? '0')}`, form_data, 'json', 'DELETE', AJAX_TIMEOUT, true)\r\n        .then((response) => {\r\n          const data = response as ajaxJSONResponse;\r\n          if (data.data === true) {\r\n            addSnackbar('Post removed. Redirecting to thread...', 'success');\r\n            pageRefresh(data.location);\r\n          } else {\r\n            addSnackbar(data.reason, 'failure', SNACKBAR_FAIL_LIFE);\r\n          }\r\n          buttonToggle(button as HTMLInputElement);\r\n        });\r\n    }\r\n  }\r\n}\r\n"]}